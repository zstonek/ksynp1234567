<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Playlist</title>
  <style>
    :root {
      --bg-light: #f0f0f0;
      --text-light: #111;
      --bg-dark: #111;
      --text-dark: #f0f0f0;
      --accent: #1db954;
    }
    body {
      margin:0; font-family:sans-serif;
      background: var(--bg-light); color: var(--text-light);
      display:flex; flex-direction:column; align-items:center;
      padding:1rem;
    }
    @media (prefers-color-scheme: dark) {
      body { background: var(--bg-dark); color: var(--text-dark); }
    }
    .player{ width:100%; max-width:400px;}
    .controls{display:flex;justify-content:space-between;margin:.5rem 0;}
    button{background:none;border:none;cursor:pointer;font-size:1.5rem;color:inherit;}
    .playlist{list-style:none;padding:0;max-height:200px;overflow-y:auto;width:100%;}
    .playlist li{padding:.5rem;cursor:pointer;}
    .playlist li.active{background:var(--accent);color:#fff;}
  </style>
</head>
<body>
  <div class="player">
    <audio id="audio"></audio>
    <div class="controls">
      <button id="prev">⏮</button>
      <button id="play">▶️</button>
      <button id="next">⏭</button>
    </div>
    <div class="controls">
      <button id="shuffle" style="opacity:.5">🔀</button>
      <button id="repeat">🔁</button>
    </div>
    <ul id="playlist" class="playlist"></ul>
  </div>

  <script>
    let playlist = [], idx=0, shuffle=false, repeatMode=0;
    const audio=document.getElementById('audio'),
          playBtn=document.getElementById('play'),
          prevBtn=document.getElementById('prev'),
          nextBtn=document.getElementById('next'),
          shuffleBtn=document.getElementById('shuffle'),
          repeatBtn=document.getElementById('repeat'),
          listEl=document.getElementById('playlist');

    // JSON 불러오기
    fetch('./playlist.json')
      .then(res=>res.json())
      .then(data=>{
        playlist = data;
        buildPlaylist();
        loadTrack(0);
      });

    function buildPlaylist(){
      playlist.forEach((item,i)=>{
        const li=document.createElement('li');
        li.textContent=item.title;
        li.onclick=()=>loadTrack(i);
        listEl.append(li);
      });
    }

    function updateActive(){
      listEl.childNodes.forEach((li,i)=>{
        li.classList.toggle('active', i===idx);
      });
    }

    function loadTrack(i){
      idx=i;
      audio.src=playlist[idx].url;
      audio.play();
      playBtn.textContent='⏸';
      updateActive();
    }

    function playPause(){
      if(audio.paused){ audio.play(); playBtn.textContent='⏸'; }
      else{ audio.pause(); playBtn.textContent='▶️'; }
    }

    function nextTrack(){
      if(shuffle) idx=Math.floor(Math.random()*playlist.length);
      else idx=(idx+1)%playlist.length;
      loadTrack(idx);
    }

    function prevTrack(){
      if(shuffle) idx=Math.floor(Math.random()*playlist.length);
      else idx=(idx-1+playlist.length)%playlist.length;
      loadTrack(idx);
    }

    audio.onended=()=>{
      if(repeatMode===1) loadTrack(idx);
      else if(repeatMode===2) nextTrack();
      else if(idx<playlist.length-1) nextTrack();
    };

    playBtn.onclick=playPause;
    nextBtn.onclick=nextTrack;
    prevBtn.onclick=prevTrack;
    shuffleBtn.onclick=()=>{
      shuffle=!shuffle;
      shuffleBtn.style.opacity=shuffle?1:.5;
    };
    repeatBtn.onclick=()=>{
      repeatMode=(repeatMode+1)%3;
      // 0: 🔁, 1: 🔂(곡반복), 2: 🔁(리스트 반복)
      repeatBtn.textContent = repeatMode===1?'🔂':'🔁';
    };
  </script>
</body>
</html>
